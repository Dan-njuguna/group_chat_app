import unittest
from django.test import TestCase
from.consumers import ChatConsumer
from datetime import datetime

class ChatConsumerTest(TestCase):
    def setUp(self):
        self.consumer = ChatConsumer()

    def test_connect(self):
        self.consumer.scope['session']['username'] = 'testuser'
        self.consumer.scope['session']['groups'] = []
        self.consumer.scope['session']['_auth_user_id'] = 1
        self.consumer.scope['session']['_auth_user_username'] = 'testuser'
        self.consumer.scope['session']['_auth_user_email'] = '<EMAIL>'
        self.consumer.scope['session']['_auth_user_is_superuser'] = False
        self.consumer.scope['session']['_auth_user_is_staff'] = False
        self.consumer.scope['session']['_auth_user_is_active'] = True
        self.consumer.scope['session']['_auth_user_date_joined'] = datetime.now()
        self.consumer.scope['session']['_messages'] = []
        self.consumer.scope['session']['_last_message_id'] = 0
        self.consumer.scope['session']['_unread_message_count'] = 0
        self.consumer.scope['session']['_socket_id'] = 'test_id'
        self.consumer.scope['session']['_accept_handler'] = self.consumer.accept
        self.consumer.scope['session']['_close_handler'] = self.consumer.close
        self.consumer.scope['session']['_receive_handler'] = self.consumer.receive
        self.consumer.scope['session']['_send_handler'] = self.consumer.send
        self.consumer.scope['session']['_send_json_handler'] = self.consumer.send_json
        self.consumer.scope['session']['_send_text_handler'] = self.consumer.send_text
        self.consumer.scope['session']['_closed'] = False
        self.consumer.scope['session']['_closed_code'] = None
        self.consumer.scope['session']['_closed_reason'] = None
        self.consumer.scope['session']['_compression'] = False
        self.consumer.scope['session']['_extensions'] = []
        self.consumer.scope['session']['_protocol'] = 'websocket'
        self.consumer.scope['session']['_transport'] = 'websocket'
        self.consumer.scope['session']['_url'] = 'ws://testserver'
        self.consumer.scope['session']['_version'] = '13'
        self.consumer.scope['session']['_ping_timeout'] = 10
        self.consumer.scope['session']['_close_timeout'] = 10
        self.consumer.scope['session']['_max_message_size'] = 1048576
        self.consumer.scope['session']['_state'] = 0
        self.consumer.scope['session']['_heartbeat_send'] = 10
        self.consumer.scope['session']['_heartbeat_receive'] = 10
        self.consumer.scope['session']['_close_code'] = 1000
        self.consumer.scope['session']['_close_reason'] = 'Normal close'
        self.consumer.scope['session']['_close_sent'] = False
        self.consumer.scope['session']['_close_received'] = False
        self.consumer.scope['session']['_client_capabilities'] = {}
        self.consumer.scope['session']['_server_capabilities'] = {}
        self.consumer.scope['session']['_server_extensions'] = []
        self.consumer.scope['session']['_server_protocol'] = 'websocket'
        self.consumer.scope['session']['_server_close_code'] = 1000
        self.consumer.scope['session']['_server_close_reason'] = 'Normal close'
        self.consumer.scope['session']['_server_close_received'] = False
        self.consumer.scope['session']['_server_close_sent'] = False
        self.consumer.scope['session']['_server_transfer_encoding'] = []
        self.consumer.scope['session']['_server_upgrade_required'] = False
        self.consumer.scope['session']['_server_response_headers'] = []
        self.consumer.scope['session']['_client_response_headers'] = []
        self.consumer.scope['session']['_client_upgrade_headers'] = []
        self.consumer.scope['session']['_client_upgrade_key'] = b'123456789012'
        self.consumer.scope['session']['_client_upgrade_version'] = b'13'
        self.consumer.scope['session']['_client_requested_protocols'] = []
        self.consumer.scope['session']['_client_requested_subprotocols'] = []
        self.consumer.scope['session']['_client_requested_extensions'] = []
        self.consumer.scope['session']['_client_requested_encoding'] = []
        self.consumer.scope['session']['_client_requested_version'] = '13'
        self.consumer.scope['session']['_client_origin'] = 'http://testserver'
        self.consumer.scope['session']['_client_host'] = 'testserver'
        self.consumer.scope['session']['_client_path'] = '/ws/chat/'
        self.consumer.scope['session']['_client_query_string'] = ''
        self.consumer.scope['session']['_client_scheme'] = 'ws'
        self.consumer.scope['session']['_client_secure'] = False
        self.consumer.scope['session']['_client_http_version'] = '1.1'
        self.consumer.scope['session']['_client_body_started'] = False
        self.consumer.scope['session']['_client_body_sent'] = False
        self.consumer.scope['session']['_client_body_received'] = False
        self.consumer.scope['session']['_client_body_buffer'] = b''
        self.consumer.scope['session']['_client_body_file'] = None
        self.consumer.scope['session']['_client_body_length'] = 0
        self.consumer.scope['session']['_client_body_max_size'] = 0
        self.consumer.scope['session']['_client_body_read'] = 0
        self.consumer.scope['session']['_client_body_remaining'] = 0
        self.consumer.scope['session']['_client_body_waiter'] = None
        self.consumer.scope['session']['_client_body_chunks'] = []
        self.consumer.scope['session']['_client_body_read_chunks'] = []
        self.consumer.scope['session']['_client_body_sent_chunks'] = []
        self.consumer.scope['session']['_client_body_sent_file'] = False
        self.consumer.scope['session']['_client_body_started_file'] = False
        self.consumer.scope['session']['_client_body_complete'] = False
        self.consumer.scope['session']['_client_body_file_size'] = 0
        self.consumer.scope['session']['_client_body_file_chunks'] = []
        self.consumer.scope['session']['_client_body_file_read'] = 0
        self.consumer.scope['session']['_client_body_file_remaining'] = 0
        self.consumer.scope['session']['_client_body_file_waiter'] = None
        self.consumer.scope['session']['_client_body_file_buffer'] = b''
        self.consumer.scope['session']['_client_body_file_temp_path'] = None
        self.consumer.scope['session']['_client_body_file_name'] = None
        self.consumer.scope['session']['_client_body_file_encoding'] = None
        self.consumer.scope['session']['_client_body_file_closed'] = False
        self.consumer.scope['session']['_client_body_file_chunks_read'] = 0
        self.consumer.scope['session']['_client_body_file_chunks_remaining'] = 0
        self.consumer.scope['session']['_client_body_file_chunks_waiter'] = None
        self.consumer.scope['session']['_client_body_file_chunks_buffer'] = b''
        self.consumer.scope['session']['_client_body_file_chunks_temp_path'] = None
        self.consumer.scope['session']['_client_body_file_chunks_name'] = None
        self.consumer.scope['session']['_client_body_file_chunks_encoding'] = None
        self.consumer.scope['session']['_auth_user_date_joined'] = datetime.now()
